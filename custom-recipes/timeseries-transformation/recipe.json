{
    "meta": {
        "label": "Timeseries transformation",
        "description": "Apply transformations to your time series, such as trend-seasonal decomposition.",
        "icon": "icon-wrench"
    },

    "kind": "PYTHON",
    "selectableFromDataset": "input_dataset",

    "inputRoles": [
        {
            "name": "input_dataset",
            "label": "Historical dataset",
            "description": "A dataset which contains time series data",
            "arity": "UNARY",
            "required": true,
            "acceptsDataset": true,
            "acceptsManagedFolder": false
        }
    ],

    "outputRoles": [
        {
            "name": "transformation_dataset",
            "label": "Transformation results",
            "description": "Dataset resulting from the time series transformation",
            "arity": "UNARY",
            "required": true,
            "acceptsDataset": true,
            "acceptsManagedFolder": false
        }
    ],
    "params": [
        {
            "type": "SEPARATOR",
            "name": "separator_transformation_type",
            "label": "Transformation type"
        },
        {
            "name": "transformation_type",
            "label": "Select a transformation",
            "type": "SELECT",
            "selectChoices": [
                {
                    "value": "seasonal_decomposition",
                    "label": "Seasonal decomposition"
                }
            ],
            "defaultValue":"seasonal_decomposition",
            "mandatory": true
        },
        {
            "name": "time_decomposition_method",
            "label": "Select a decomposition method",
            "type": "SELECT",
            "visibilityCondition" : "model.transformation_type == 'seasonal_decomposition'",
            "selectChoices": [
                {
                    "value": "STL",
                    "label": "STL, Seasonal-Trend decomposition using LOESS"
                },
                {
                    "value": "classical",
                    "label": "Classical decomposition"
                }
            ],
            "defaultValue":"STL"
        },
        {
            "type": "SEPARATOR",
            "name": "separator_input",
            "label": "Input parameters"
        },
        {
            "name": "time_column",
            "label": "Time column",
            "allowedColumnTypes": [
                "date"
            ],
            "type": "COLUMN",
            "description": "Must be a parsed date",
            "columnRole": "input_dataset",
            "mandatory": true
        },
        {
            "name": "target_column",
            "label": "Target column",
            "type": "COLUMN",
            "allowedColumnTypes": [
                "tinyint",
                "smallint",
                "int",
                "bigint",
                "float",
                "double"
            ],
            "columnRole": "input_dataset",
            "mandatory": true
        },
        {
            "name": "frequency_unit",
            "label": "Frequency",
            "type": "SELECT",
            "description": "Frequency of your historical data",
            "mandatory": true,
            "selectChoices": [
                {
                    "value": "min",
                    "label": "Minute"
                },
                {
                    "value": "H",
                    "label": "Hour"
                },
                {
                    "value": "D",
                    "label": "Day"
                },
                {
                    "value": "B",
                    "label": "Business Day (Mon-Fri)"
                },
                {
                    "value": "W",
                    "label": "Week"
                },
                {
                    "value": "M",
                    "label": "Month"
                },
                {
                    "value": "3M",
                    "label": "Quarter"
                },
                {
                    "value": "6M",
                    "label": "Semester"
                },
                {
                    "value": "12M",
                    "label": "Year"
                }
            ],
            "defaultValue": "D"
        },

        {
            "type": "SEPARATOR",
            "name": "stl_parameters",
            "label": "STL parameters",
            "description": "Seasonal-Trend decomposition using Loess",
            "visibilityCondition" : "model.time_decomposition_method == 'STL'"
        },
        {
            "type": "SELECT",
            "name": "model_stl",
            "label": "Model type",
            "selectChoices": [
                {
                    "value": "additive",
                    "label": "Additive"
                },
                {
                    "value": "multiplicative",
                    "label": "Multiplicative"
                }],
            "defaultValue": "additive",
            "description": " If the magnitude of the seasonality varies over time, then the series is multiplicative. Otherwise, the series is additive.",
            "visibilityCondition" : "model.time_decomposition_method == 'STL'"
        },
        {
            "name": "seasonal_stl",
            "label": "Seasonal smoother",
            "type": "INT",
            "description": "Odd integer. Number of consecutive timesteps (years, weeks..) to be used in estimating each value in the seasonal component. It controls how rapidly the seasonal component can change.",
            "defaultValue": 13,
            "minI": 7,
            "visibilityCondition" : "model.time_decomposition_method == 'STL'"
        },
        {
            "name": "expert_stl",
            "label": "Expert mode",
            "type": "BOOLEAN",
            "defaultValue": false,
            "visibilityCondition" : "model.time_decomposition_method == 'STL'"
        },
        {
            "name": "robust_stl",
            "label": "Robust to outliers",
            "type": "BOOLEAN",
            "defaultValue": false,
            "mandatory": false,
            "visibilityCondition" : "model.time_decomposition_method == 'STL' && model.expert_stl",
            "description": "If selected, the estimation will re-weight data, allowing the model to tolerate larger errors."
        },
        {
            "type": "SEPARATOR",
            "name": "separator_degrees",
            "label": "Fitting method in Loess",
            "visibilityCondition" : "model.time_decomposition_method == 'STL' && model.expert_stl"
        },
        {
            "name": "seasonal_degree_stl",
            "label": "Local fitting method for seasonal extraction",
            "type": "SELECT",
            "selectChoices": [
                {
                    "value": "0",
                    "label": "Constant (weighted moving averages)"
                },
                {
                    "value": "1",
                    "label": "Linear"
                }],
            "defaultValue": "1",
            "mandatory": false,
            "description": "Degree of the polynomial used by seasonal Loess",
            "visibilityCondition" : "model.time_decomposition_method == 'STL' && model.expert_stl"
        },
        {
            "name": "trend_degree_stl",
            "label": "Local fitting method for trend extraction",
            "type": "SELECT",
            "selectChoices": [
                {
                    "value": "0",
                    "label": "Constant (weighted moving averages)"
                },
                {
                    "value": "1",
                    "label": "Linear"
                }],
            "defaultValue": "1",
            "mandatory": false,
            "description": "Degree of the polynomial used by trend Loess",
            "visibilityCondition" : "model.time_decomposition_method == 'STL' && model.expert_stl"
        },
        {
            "name": "lowpass_degree_stl",
            "label": "Local fitting method for the low pass filter",
            "type": "SELECT",
            "selectChoices": [
                {
                    "value": "0",
                    "label": "Constant (weighted moving averages)"
                },
                {
                    "value": "1",
                    "label": "Linear"
                }],
            "defaultValue": "1",
            "mandatory": false,
            "description": "Degree of the polynomial used by low pass Loess",
            "visibilityCondition" : "model.time_decomposition_method == 'STL' && model.expert_stl"
        },
        {
            "type": "SEPARATOR",
            "name": "separator_speedup",
            "label": "Performance",
            "description": "Options to speed up computation. It may impair the fit of the model.",
            "visibilityCondition" : "model.time_decomposition_method == 'STL' && model.expert_stl"
        }
    ],
    "resourceKeys": []
}
